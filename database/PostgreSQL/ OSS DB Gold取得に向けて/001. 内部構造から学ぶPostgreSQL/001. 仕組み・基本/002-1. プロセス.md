## 主要プロセスについて
✅「DBクラスタ($PGDATA)」単位で、マスタプロセス(postmaster)が起動する。<br>
<br>
　DBクラスタ >>> データベース >>> テーブル

<img src="https://github.com/user-attachments/assets/4cb43575-da31-47ed-a200-2dd61f64e01a" width="800px" />

## 更新時のプロセス間のやりとり

<img src="https://github.com/user-attachments/assets/d0cc1166-661b-4015-b7d5-13f128d6f360" width="800px" />


## チェックポインタ と バックグラウンドライタ
✅どちらも「`shared_buffers`内のダーディバッファをディスクへ書き込む」点は同じ。<br>
<img width="800px" height="586" alt="image" src="https://github.com/user-attachments/assets/9e9a87a4-5e7e-4f89-8a7f-bec22f93f9ee" />

### Background Writer process
- 目的/役割：bgwriterが予めディスクへ書き出しておくことで、バックエンドが即座にバッファ/スロットを再利用できるようにする。
- 書き出し対象：長らく参照されていないページ/スロット（**置き換わる可能性があるのでその前にフラッシュさせたい**）
- 書き出し頻度：`bgwriter_delay`間隔で動く。
- 書き出し上限：`bgwriter_lru_maxpages`で、１度のサイクルで書きだせるページ数が決まっている。

### Checkpointer process
- 目的/役割：**WALに記録済みの全ての変更を安全にディスクへ同期**（クラッシュリカバリの短縮）
- 書き出し対象：`shared_buffers`内の**全ての**ダーディバッファ
- 書き出し頻度：`checkpoint_timeout`間隔 or WALが`max_wal_size`に達したら。
- 書き出し上限： ----
- 書き出しスピード：`checkpoint_completion_target`で制御。
  - 5分間隔でチェックポイントが発生する場合、チェックポイント処理を4分59秒使い切るか最短でやるかの話。
  - `1.0`：次のチェックポイントまでの時間いっぱいを使って、**負荷を分散して**書き込む。
  - `0.0`：一気に書く。ほぼ一瞬で終わるが**I/O負荷高めになる**。

#### チェックポイント実行時に「チェックポイントレコード」をWALに記録する。
- チェックポイントは「**ある時点までのデータ変更がディスクに確実に反映された**」という**安全ポイント**を意味します。
- この安全ポイントをクラッシュリカバリで利用するために、チェックポイントの情報（位置・状態など）を WAL に記録しておく必要があるのです。

