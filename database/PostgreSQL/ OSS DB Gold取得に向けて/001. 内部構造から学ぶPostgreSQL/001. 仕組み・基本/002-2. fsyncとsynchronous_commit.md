## fsyncとは？
### OSにおけるfsync
- UNIX系OSには`fsync()`というシステムコールがある。
- これは「指定したファイルに対する書き込みを、OSキャッシュだけでなく実際のディスクにも反映させろ」 という命令です。
- 通常、ファイルに書き込むと一旦 OS のページキャッシュに溜まり、物理ディスクに書かれるのは後で（遅延書き込み）。
- `fsync()`を呼ぶことで、その遅延を待たずにディスクに確実に書き込みます。

### PostgreSQLにおけるfsync
- ↓のような「ディスクに対する書き込み処理」において、↑の`fsync`を有効にさせる。
  - COMMIT時にWALファイルをフラッシュする
  - `checkpointer`によるDirtyバッファをフラッシュする
- `fsync: false`にしても「待たない/保証しない」だけで、書き込み処理自体は行う✅

<br>

## synchronous_commit（コミットの「完了基準」）
COMMIT完了の基準がこのパラメータ設定値で変わる。
- `off`だと
  - 「COMMIT完了」
  - 「WALログのfsync完了」🔴※COMMIT完了した後にfsync!!!
- `local`だと
  - 「WALログのfsync完了」
  - 「COMMIT完了」
- `remote_write`だと
  - 「WALログをローカルディスクにfsync完了」
  - 「リモートサーバへ送信完了」
  - 「COMMIT完了」
- `on`だと
  - 「WALログをローカルディスクにfsync完了」
  - 「リモートサーバへ送信完了」
  - 「リモートサーバのローカルディスクにてfsync完了」
  - 「COMMIT完了」

✅fsync=off にすると synchronous_commit の意味がほぼなくなる。<br>
✅fsync=on かつ synchronous_commit=on が最も安全（その分遅い）。<br>
