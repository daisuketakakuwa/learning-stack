
## EXPLAINで見れる実行計画を理解する
- EXPLAIN(実行計画)をもととなる統計情報について
  - pg_stats と pg_statistic の違い
    - 元テーブル(pg_statistic)をもとに、User向けに分かりやすくしてるのがpg_statsビュー
    - 元テーブル(pg_statistic)は内部管理用なので基本見ない。SUPERユーザーのみ参照可能。
    - ANALYZEコマンドで更新されるのは元テーブル(pg_statistic)。
    - pg_statsの`most_common_vals`,`most_common_freqs`を見て実行計画を決める！
  - サンプリングについて
    - 統計情報の収集はランダム・サンプリングを採用している。
    - サンプリング範囲は`default_statistics_target`パラメータで調整。大きいほど精度UP。
    - サンプリング範囲はテーブルごとに設定可能👍<br>`ALTER TABLE [テーブル名] ALTER [列名] SET STATISTICS 1000`
  - 実行計画関連のパラメータ
    - seq_page_cost（デフォ：1.0）
      - 順次読み込み（Seq Scan）のコスト
    - random_page_cost（デフォ：4.0）
      - IndexScan時にランダムIOの発生コストを設定。
      - 低ければIndexScanが採用されやすくなる👍
      - SSD/キャッシュ環境では 1.1〜2.0 が現実的。
    - effective_cache_size
      - PostgresSQLが動作しているOS上のファイルキャッシュ(メモリ量)をどれくらい使えるか？の指標（単位：MB）
        - PostgreSQLのメモリ（`shared_buffers`）➡ ページ単位の読み書き
        - OS上のメモリ➡🔴`shared_buffers`に載っていないページでも、こちらでキャッシュされている可能性がある！（`effect_cache_size`はOS上メモリにどれくらいキャッシュを搭載できそうか？の指標）
      - RAM 16GBのサーバなら、shared_buffers = 4GB、effective_cache_size = 12GB
