## pg_class = オブジェクトの物理情報
- オブジェクト is
  - テーブル(relation)
  - インデックス
  - PK,FK制約 

```sql
SELECT
  oid,
  relname,
  relfilenode,
  relpages,
  reltuples
FROM
  pg_class
WHERE
  relname NOT LIKE '%pg_%';
```

## pg_locks
- テーブル単位/行単位で発生しているロックを確認できる。
- `granted`： true → ロック獲得済、false → `ロック待ち`

<img width="700px" src="https://github.com/user-attachments/assets/7cddf666-0c27-4f2a-bae4-25e5f5ad57d8" />


## locksのテーブル情報は「oid(オブジェクトID)」なので、論理名をpg_classからとってくる

- `pg_locks > relation`にはオブジェクトIDが入っている（論理名ではない）

<img width="700px" src="https://github.com/user-attachments/assets/7a470784-30dc-4954-ad75-79209ba37588" />

## どのクエリが待機(ロック待ち)なのか、pg_stat_activityからとってくる
- locks も activityも「BEプロセス」に紐づく情報なので、`pid`で紐づける。

<img width="700px" src="https://github.com/user-attachments/assets/59d607b2-cf9a-42e1-840e-1ed931985685" />


