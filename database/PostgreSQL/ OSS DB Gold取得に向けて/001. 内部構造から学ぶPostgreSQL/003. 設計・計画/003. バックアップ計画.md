## PostgreSQLには３種類のバックアップ方法
1. オフライン × 物理（稼動してないのでファイルコピーのみ）
2. オンライン × 物理（稼動中なので最新WAL含めてファイルコピー）
3. オンライン × 論理（SQLへ出力する）

### 物理バックアップ VS 論理バックアップ
- 同じPostgreSQLバージョンが使えるかどうか（物理：使えない）
- 復旧速度がどれくらいかかるか（そのままファイルを使用する物理は高速）

### ①オフライン × 物理
- $PG_DATA配下をそのままコピーするだけ。一番シンプル。
- `pg_dump`のようなコマンドは一切使わない👍

### ②オンライン × 物理
- 稼動しながらなのでそのままOS機能のコピーコマンドは使えない✕
- PostgreSQLサーバによる`pg_basesbackup`コマンドにより、$PGDATAと同じディレクトリ構成のバックアップを作成してくれる。
- ベースバックアップだけだと完全復元できないから、＋アーカイブファイル（WAL）でバックアップ中に発生した更新分含め完全復元できる👍（-Xオプションで`archive_mode`を一時的にONになるような挙動）
```
pg_basebackup -U replication_user -D /backup/directory -Fp -Xs -P
```

### ③オンライン × 論理
- "論理"なので、そのまま$PGDATAディレクトリをコピーするわけではなく別の形(`SQL`)へ変換する。
- 現在のテーブル構成/中のデータを再現するためのSQLを出力してくれる。
- 👉SQLなのでバックアップ元と先でPostgreSQLバージョンの互換性なくても平気！
- **SQLを出力するためのコマンドは２つある。**
  - `pg_dump`コマンド（特定のDBのみ）
  - `pg_dumpall`コマンド（すべてのDB＋グローバル情報）
 
```
# 特定のDBのみバックアップする場合
pg_dump -U username -d database_name -f backup.sql
```
```
# すべてのDB＋グローバル情報をバックアップする場合
pg_dumpall -U username -f backup_all.sql
```
