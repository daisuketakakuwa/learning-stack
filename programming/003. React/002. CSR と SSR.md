# ç·æ‹¬
- CSRï¼šBrowserã§JSãƒ­ãƒ¼ãƒ‰ã—ãªã„ã¨ãƒšãƒ¼ã‚¸åˆ©ç”¨ã§ããªã„ã€‚
- SSRï¼šServerå´ã§JSãƒ­ãƒ¼ãƒ‰ã—ã¦å®Œæˆã•ã›ãŸHTMLã‚’è¿”ã™ã€‚<br>
ãƒ»ã¾ãšServerã‚ˆã‚Š Available ãª HTMLã‚’å—ã‘å–ã‚‹ -> ãƒšãƒ¼ã‚¸ãŒã™ãè¦‹ã‚Œã‚‹ã€‚<br>
ãƒ»AvaiableãªHTML ã«å¯¾ã—ã¦ JSãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€Reactive ãªãƒšãƒ¼ã‚¸ã¨ãªã‚‹ã€‚

# Client Rendering
- [renderé–¢æ•°](https://ja.legacy.reactjs.org/docs/react-dom.html#render)ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶å´ã§å‹•ãã€‚
```js
ReactDOM.render(<App />, document.getElementById('root'));
```

# Server Rendering (Hydrate = é™çš„ãªWebãƒšãƒ¼ã‚¸ã‚’Reactiveã«ã™ã‚‹)
- Server-side rendering makes HTML available to the client **before JavaScript loads/before fully interactive.** 
- Your site visitors can see and read your content even if it is not fully interactive.
- ä»Šã¾ã§ä½¿ã£ã¦ãŸrenderé–¢æ•°ã‚’[hydrateé–¢æ•°](https://ja.legacy.reactjs.org/docs/react-dom.html#hydrate)ã«ç½®ãæ›ãˆã‚‹ã€‚<br>
ãƒ»ReactDOM.render -> ç¬¬1å¼•æ•°ã®Componentã‚’ãƒ–ãƒ©ã‚¦ã‚¶å´ã§æ§‹ç¯‰ã—ã¦ä»®æƒ³DOMã«åæ˜ ã€‚<br>
ãƒ»ReactDOM.hydrate -> **ç¬¬1å¼•æ•°ã®Componentã¯ã‚µãƒ¼ãƒå´ã§æ§‹ç¯‰æ¸ˆã€‚ã‚µãƒ¼ãƒå´ã§ç”Ÿæˆã—ãŸHTMLæ–‡å­—åˆ—ã‚’å†åˆ©ç”¨(hydrate)ã—ã¦interactiveã«ã™ã‚‹ã€‚**
```js
ReactDOM.hydrate(<App />, document.getElementById('root'));
```
Server(Express)å´ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«
1. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹ã€‚
2. `ReactDOMServer.renderToString`ã§å¯¾è±¡Component(ReactTree)ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦HTMLæ–‡å­—åˆ—ç”Ÿæˆã€‚
3. ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹`build/index.html`å†…ã«ã€Componentã®HTMLæ–‡å­—åˆ—ã‚’å·®ã—è¾¼ã‚€ã€‚
```js
app.get('/', (req, res) => {
  const app = ReactDOMServer.renderToString(<App />);
  const indexFile = path.resolve('./build/index.html');

  fs.readFile(indexFile, 'utf8', (err, data) => {
    if (err) {
      console.error('Something went wrong:', err);
      return res.status(500).send('Oops, better luck next time!');
    }

    return res.send(
      data.replace('<div id="root"></div>', `<div id="root">${app}</div>`)
    );
  });
});
```
Refer: [How to Enable Server-Side Rendering for a React App](https://www.digitalocean.com/community/tutorials/react-server-side-rendering)

## Serverå´ã§non-interactiveãªHTMLã‚’ç”Ÿæˆã™ã‚‹ã€‚
[ReactDOMServer.renderToStringé–¢æ•°](https://react.dev/reference/react-dom/server/renderToString)ã‚’ä¸€ä¾‹ã«ç†è§£ã™ã‚‹ã€‚

ReactDOMServer.renderToStringé–¢æ•°ã«ã¤ã„ã¦
- Rendering a React tree as HTML to a string
Serverå´ã§æ§‹ç¯‰ã—ãŸReact tree(ä»®æƒ³DOM)ã‚’ã€HTMLæ–‡å­—åˆ—ã¨ã—ã¦ç”Ÿæˆã™ã‚‹ã€‚
- This will produce the initial non-interactive HTML output of your React components. 
**non-interactive**ãªHTMLã‚’ç”Ÿæˆã™ã‚‹ã€‚â€»**interactive = useStateã¨ã‹ä½¿ãˆã‚‹çŠ¶æ…‹**
- On the client, you will need to call hydrateRoot to hydrate that server-generated HTML and make it interactive.
**serverå´ã§ç”Ÿæˆã—ãŸHTMLæ–‡å­—åˆ—ã¯non-interactive**ãªã®ã§ã€ãã®ã¾ã¾ã ã¨**useStateé–¢æ•°ã‚’ã¯ã˜ã‚ã¨ã—ãŸinteractiveãªå‡¦ç†ãŒå‹•ã‹ãªã„ã€‚= hydrateé–¢æ•°ã¯interactiveã«ã™ã‚‹å½¹å‰²ğŸ‘**

âœ…`hydrate`ã¨ã¯
- Serverå´ã§ç”Ÿæˆã—ãŸã€ŒReact treeã‚’HTMLæ–‡å­—åˆ—åŒ–ã—ãŸã‚‚ã®(non-interactive)ã€ã‚’INPUTã«ã€Browserå´ã§interactiveã«å‹•ãã‚ˆã†ã«ã™ã‚‹ã“ã¨ã€‚
- Serverå´ã§ç”Ÿæˆã—ãŸHTMLæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾ä½¿ã†ã“ã¨ã‹ã‚‰ã€hydrate(å†åˆ©ç”¨)ã¨å‘¼ã°ã‚Œã‚‹ã€‚
- Attach this HTML string to its original React component so that the application works interactiveğŸ‘

## SSRã™ã‚‹å ´åˆã®Routingè¨­å®š
- CSRã®å ´åˆã€Clientå´ã®ã¿æ„è­˜ã—ã¦Routingè¨­å®šã™ã‚Œã°OKã ã£ãŸã€‚
- SSRã®å ´åˆã€Serverå´ã§Pre-renderã™ã‚‹ã¨ãã«è‰²ã€…Routingè¨­å®šãŒå¿…è¦ã€‚

Step1: SimpleãªRoutingã®ã¿
Step2: SimpleãªRouting + Date Routing
### Simple Routing

https://github.com/remix-run/react-router/tree/main/examples/ssr

### Data Routing(decouple the data fetching from rendering)

https://github.com/remix-run/react-router/tree/main/examples/ssr-data-router

## QA
ğŸ‘‰ãƒšãƒ¼ã‚¸é·ç§»ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é–¢é€£ã¯`react-router-dom`ã®è²¬å‹™ã ã£ãŸã®ã§ã€[react-router-domã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://reactrouter.com/en/main/guides/ssrã‚’ç¢ºèªã™ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆï¼
### CSRã®ã‚ˆã†ã«`npm run build`ã—ã¦ãƒ“ãƒ«ãƒ‰ç‰©ã‚’äº‹å‰ç”¨æ„ã™ã‚‹ï¼Ÿ
- ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚
- ãƒ“ãƒ«ãƒ‰ã—ãŸnon-interactiveãªHTMLæ–‡å­—åˆ—ã‚’ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸã¨ãã«index.htmlã«çµ„ã¿è¾¼ã‚“ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™ã€‚
### å„ãƒšãƒ¼ã‚¸ã”ã¨ã«HTMLã‚’ç”Ÿæˆã™ã‚‹ã®ï¼Ÿ
- ã—ãªã„ã€‚index.htmlå†…ã«non-interactiveãªHTMLæ–‡å­—åˆ—ã‚’çµ„ã¿è¾¼ã‚€ã€‚
### å„ãƒšãƒ¼ã‚¸ã¸ã®ç›´ã‚¢ã‚¯ã‚»ã‚¹ã¯ï¼Ÿ
- Data Routerã‚’ä½¿ãˆã°å®Ÿç¾ã§ãã‚‹ã€‚
### ãƒšãƒ¼ã‚¸åˆæœŸè¡¨ç¤ºã§APIã‚³ãƒ¼ãƒ«ã™ã‚‹å‹•ãã¯ã©ã†ãªã‚‹ï¼Ÿ
- Data Routingã‚’ä½¿ã†ã“ã¨ã§ã€Serverå´ã§HTMLæ–‡å­—åˆ—ç”Ÿæˆã™ã‚‹ã¨ãã«DataFetchã™ã‚‹ã€‚
### Cacheã®BestPracticeã¯ï¼Ÿ
â€»TDL
# SSRã®Routingã¯RemixãŒä¾¿åˆ©ãªè©±
ã‚·ãƒ³ãƒ—ãƒ«ãªroutingè¨­å®šã ã‘ãªã‚‰React Router(`react-router-dom`)ã‚’ä½¿ã†ã ã‘ã§äº‹è¶³ã‚Šã‚‹ãŒã€å®Ÿéš›ã«ã‚¢ãƒ—ãƒªé–‹ç™ºã™ã‚‹ä¸Šã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã“ã¨ã‚’Handleã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- Bundling your code for the server and the browser
- Not bundling server-only code into the browser bundles
- Code splitting that works on the server and in the browser
- Server Side data loading so you actually have something to render
- Data loading strategies that work on the client and server
- Handling code splitting in the server and client
- Proper HTTP status codes and redirects
- Environment variables and secrets
- Deployment

Remixã¯React Routerã‚’åœŸå°ã«ä½œã‚‰ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚ä¸Šè¨˜ã®ã“ã¨ã‚’å…¨ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹ã®ã§ä½¿ã†ã¹ãã€‚ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é–¢é€£ã§ç´°ã‹ã„ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’è¡Œã„ãŸã„å ´åˆã¯ã€React Routerã®ã¿ã§è‡ªã‚‰â†‘ã‚’å®Ÿç¾ã™ã‚‹ã€‚

# Reactã§SSRã™ã‚‹ãªã‚‰Next.jsãŒä¾¿åˆ©ãªè©±
ãã“ã‚‰ã¸ã‚“ã®GitHubãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ OR ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç”»æ™‚(å¿…è¦ã«ãªã£ãŸã¨ã)ã«å‹‰å¼·ã™ã‚Œã°OKã€‚

# React18ã®å¤‰æ›´ç‚¹

https://ja.react.dev/blog/2022/03/08/react-18-upgrade-guide#updates-to-server-rendering-apis

CSR
ãƒ»[renderé–¢æ•°](https://ja.legacy.reactjs.org/docs/react-dom.html#render) -> [createRooté–¢æ•°](https://ja.legacy.reactjs.org/docs/react-dom-client.html#createroot)

SSR
ãƒ»[hydrateé–¢æ•°]() -> [hydrateRooté–¢æ•°](https://ja.legacy.reactjs.org/docs/react-dom-client.html#hydrateroot)