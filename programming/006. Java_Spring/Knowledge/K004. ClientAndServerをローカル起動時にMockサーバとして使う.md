# å‰æ
ğŸ”´org.mockserver.integration.ClientAndServerã¯ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åé€šã‚Š**IntegrationTestã®ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€‚**

ã€€ProcessAPIã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã€‘â†’ SystemAPIã€**ã“ã‚Œã‚’ClientAndServerã§ãƒ¢ãƒƒã‚¯åŒ–**ã€‘
 
ãŸã ä½¿ã„æ–¹ã«ã‚ˆã£ã¦ã¯ã€ï¼‘ã¤ã®SpringBootã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•ã™ã‚‹æ™‚ã«ãƒ¢ãƒƒã‚¯ç”¨APIã¨ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã£ã¦ã‚ã‘ã€‚ãŸã¶ã‚“ã‚„ã‚‰ã‚“ã‘ã©ã€‚

# ã‚„ã‚ŠãŸã„ã“ã¨
HogeAPIã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•ã™ã‚‹éš›ã«ã€HogeAPIã‹ã‚‰å‘¼ã³å‡ºã™FugaAPIã‚’**MockAPIã¨ã—ã¦**èµ·å‹•ã™ã‚‹ã€‚<br>
âœ…ãƒã‚¤ãƒ³ãƒˆ1: MockAPIèµ·å‹•ï¼**ClientAndServerã‚’ä½¿ã†ã€‚**<br>
âœ…ãƒã‚¤ãƒ³ãƒˆ2: ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•æ™‚ã®ã¿ç‰¹å®šã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œï¼**Springãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã†ã€‚**<br>



# â‘ ClientAndServerã§MockAPIã‚’èµ·å‹•ã•ã›ã‚‹ã€‚
## ä¾å­˜é–¢ä¿‚
```xml
<dependency>
	<groupId>org.mock-server</groupId>
	<artifactId>mockserver-netty</artifactId>
	<version>5.14.0</version>
</dependency>
```
 
## MockAPIèµ·å‹•ç”¨ã‚¯ãƒ©ã‚¹
```java
package com.javapractice.javapractice.mockapi;

import ;
import static org.mockserver.model.HttpRequest.request;
import static org.mockserver.model.HttpResponse.response;

public class MockApiConfiguration {

    private ClientAndServer mockServer;

    public MockApiConfiguration() {
        // mockapi starts on port 9999
        this.mockServer = ClientAndServer.startClientAndServer(9999);
	// mockapi returns the following responses
        this.mockServer.when(
                request()
                        .withMethod("GET")
                        .withPath("/helloworld"))
                .respond(
                        response()
                                .withBody("HELLO WORLD"));
    }

}
```

## â†‘MockAPIèµ·å‹•ç”¨ã‚¯ãƒ©ã‚¹ã‚’Beanç™»éŒ²
```java
package com.javapractice.javapractice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Profile;

import com.javapractice.javapractice.mockapi.MockApiConfiguration;

@SpringBootApplication
public class JavaPracticeApplication {

	public static void main(String[] args) {
		SpringApplication.run(JavaPracticeApplication.class, args);
	}

	@Bean
	public MockApiConfiguration mockApiConfiguration() {
		return new MockApiConfiguration();
	}

}
```

## èµ·å‹• > MockAPIã®èµ·å‹•ç¢ºèª > ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ã£ã¦ã¿ã‚‹
```:Mavenã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•
mvn clean spring-boot:run
```
```:èµ·å‹•ãƒ­ã‚°
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.7.4)

2022-10-04 14:30:03.273  INFO 13820 --- [           main] c.j.j.JavaPracticeApplication            : Starting JavaPracticeApplication using Java 17.0.1 on TABLET-G9B5BEIQ with PID 13820 (C:\Users\daisu\Desktop\workspace\java-practice\target\classes started by daisuke in C:\Users\daisu\Desktop\workspace\java-practice)
2022-10-04 14:30:03.273  INFO 13820 --- [           main] c.j.j.JavaPracticeApplication            : The following 1 profile is active: "local"
2022-10-04 14:30:04.717  INFO 13820 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2022-10-04 14:30:04.733  INFO 13820 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2022-10-04 14:30:04.733  INFO 13820 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.65]
2022-10-04 14:30:04.960  INFO 13820 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2022-10-04 14:30:04.960  INFO 13820 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1586 ms
////////// ã“ã®ãƒ­ã‚°ã‚ˆã‚ŠMockAPIãŒã€Œ/helloworldã€ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹
2022-10-04 14:30:05.787  INFO 13820 --- [erver-EventLog0] org.mockserver.log.MockServerEventLog    : 9999 started on port: 9999
2022-10-04 14:30:06.403  INFO 13820 --- [erver-EventLog0] org.mockserver.log.MockServerEventLog    : 9999 creating expectation:

  {
    "httpRequest" : {
      "method" : "GET",
      "path" : "/helloworld"
    },
    "httpResponse" : {
      "body" : "HELLO WORLD"
    },
    "id" : "5e2fb0b6-703d-4f74-8666-5270066e3145",
    "priority" : 0,
    "timeToLive" : {
      "unlimited" : true
    },
    "times" : {
      "unlimited" : true
    }
  }

 with id:

  5e2fb0b6-703d-4f74-8666-5270066e3145

2022-10-04 14:30:06.844  WARN 13820 --- [           main] o.s.b.a.m.MustacheAutoConfiguration      : Cannot find template location: classpath:/templates/ (please add some templates, check your Mustache configuration, or set spring.mustache.check-template-location=false)
```
å‹•ä½œç¢ºèª(HELLO WORLDãŒè¿”ã£ã¦ããŸã‚‰OKğŸ‘)
```
C:\Users\daisu>curl http://localhost:9999/helloworld
HELLO WORLD
```

# â‘¡Springãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•æ™‚ã®ã¿MockAPIã‚’èµ·å‹•ã•ã›ã‚‹ã€‚
MockAPI(`MockApiConfiguration.java`)ã¯**ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«**è¨­å®šã™ã‚‹ã€‚

## @Profile("local")ã‚’è¿½åŠ 
```java
// ãã®ä»–IMPORTæ–‡çœç•¥
import org.springframework.context.annotation.Profile;

@SpringBootApplication
public class JavaPracticeApplication {

	public static void main(String[] args) {
		SpringApplication.run(JavaPracticeApplication.class, args);
	}

	@Bean
	@Profile("local") // è¿½åŠ 
	public MockApiConfiguration mockApiConfiguration() {
		return new MockApiConfiguration();
	}

}
```

## èµ·å‹•æ™‚ã«ProfileæŒ‡å®š
```:Mavenã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•
mvn clean spring-boot:run -Dspring.profiles.active=local
```
ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ä»¥å¤–(application.propertiesç­‰)ã§ã‚‚ã€ACTIVEã«ã™ã‚‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šãŒå¯èƒ½ã€‚

# â€»è‡ªåˆ†ç”¨ãƒ¡ãƒ¢
## @Beanãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€SpringBootã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å®Ÿè¡Œï¼†returnã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’DIã‚³ãƒ³ãƒ†ãƒŠã«ä¿ç®¡ã—ã¦ãŠãã€‚
```java
@Bean
public MockApiConfiguration mockApiConfiguration() {
	System.out.println("MockApiConfiguration bean created.")
	return new MockApiConfiguration();
}
```